## 机器学习课程设计

### 前言

本项目是机器学习课程设计的项目, 主要内容是利用 **机器学习** 算法实现 **高糖预测** 功能.

小组成员: [19220432 陆昊宇](https://github.com/Mr-LUHAOYU), [19220448 董文杰](https://github.com/Explorer-Dong), [19220430 沈子毅](https://github.com/saddcas)

### 一. 数据预处理

数据集包含 16 个糖前用户多天的时序特征和血糖真值. 其中特征包括: 血容量脉冲(BVP)信号, 皮肤电活动(EDA), 皮肤温度(TEMP), 三轴加速度计(ACC), 心率(HR), 搏动间隔(IBI). 同时还包括时间戳和葡萄糖浓度(mg/dl).

我们对每一个用户的时序数据分别进行预处理和保存. 预处理包括:

1. 数据映射: 我们将每个用户的多天数据以 0.25ms 的粒度映射到一天的 $[0, 345599]$ ms 中.
2. 缺失异常值处理: 我们利用准确真实的数据进行线性(linear)插值处理, 从而将所有的缺失值和异常值进行填充.
3. 归一化: 我们对每一个用户除了时间戳和血糖值之外的其他特征进行 **最大最小值** 归一化处理, 使得其值域落在 $[0, 1]$ 之间.
4. 可视化: 我们利用 `subplots` 绘制每一个用户的血糖值变化图进行时序特征的观察, 便于后续特征工程的处理.

最终对于每一个用户可以得到类似于下面结构的 **属性特征** 矩阵:

| datetime |  eda  | temp  |  ibi  | acc_x | acc_y | acc_z |  bvp  |  hr   |
| :------: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|    9     | 0.448 | 0.939 | 0.395 | 0.386 | 0.714 | 0.630 | 0.430 | 0.141 |

### 二. 特征工程

本阶段, 我们首先利用 **快速傅里叶变换(FFT)** 和 **预训练模型(xgboost)** 删除无关特征 bvp 和 ibi.  然后将剩余的的合理特征以 $1$ 分钟为时序间隔进行特征提取以及 $\text{PCA}$ 降维, 最终得到可用于训练和预测的数据.

#### 2.1 排除无关特征

在进行特征提取前, 我们有必要对数据进行第一轮降维. 为此我们引入 **快速傅里叶变换(FFT)** 和 **预训练模型(xgboost)**.

**对于 FFT 策略**. 我们尝试将所有特征关于血糖值一一进行频谱分析比对, 如果两者频谱图在相同量纲下趋势相同则认为该特征与血糖变化趋势强相关, 反之则认为弱相关, 需要排除该特征. 最终发现 bvp 和 ibi 两个特征与血糖呈现弱相关 (如下图所示), 我们将这两个特征维度直接删除.

![left: bvp VS suger, right: ibi VS suger]()

**对于预训练策略**. 我们引入 xgboost 模型, 得到 16 人的预训练数据 (如下表所示). 其中 $\text{cnt}$ 表示从所有特征中选择预训练特征的数量, 其余特征数值表示特征与血糖的逆关系, 数值越大表明该特征与血糖越无关. 可以发现无论从所有特征中选择多少个用于预训练的特征, bvp 和 ibi 始终都和血糖的关系最弱, 因此需要删除 bvp 和 ibi 这两个特征. 此时结论与使用 FFT 策略的结论互相佐证.

| cnt | datetime  | eda | temp | ibi | acc\_x | acc\_y | acc\_z | bvp | hr |
|:-:|:---------:| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
| 1 |    1.0    | 3.125 | 2.25 | **7.6875** | 6.3125 | 5.8750 | 6.0000 | **8.9375** | 3.8125 |
| 2 |    1.0    | 2.125 | 1.25 | **6.6875** | 5.3125 | 4.8750 | 5.0000 | **7.9375** | 2.8125 |
| 3 |    1.0    | 1.375 | 1.00 | **5.6875** | 4.3125 | 3.8750 | 4.0000 | **6.9375** | 1.8125 |
| 4 |    1.0    | 1.000 | 1.00 | **4.6875** | 3.3125 | 2.8750 | 3.0625 | **5.9375** | 1.1250 |
| 5 |    1.0    | 1.000 | 1.00 | **3.6875** | 2.3125 | 1.8750 | 2.1250 | **4.9375** | 1.0625 |
| 6 |    1.0    | 1.000 | 1.00 | **2.7500** | 1.5625 | 1.2500 | 1.5000 | **3.9375** | 1.0000 |
| 7 |    1.0    | 1.000 | 1.00 | **1.8750** | 1.0625 | 1.0625 | 1.0625 | **2.9375** | 1.0000 |

#### 2.2 特征提取

在经过 2.1 步删除了两个特征后, 还剩 8 个特征需要进行提取. 我们以 5 分钟为一个阶段. 特别的, 为了更好的利用时序数据, 我们让每一个 5 分钟区间都和前一个 5 分钟区间重合 4 分钟 (第一个区间除外). 这样对于一天共 1440 分钟, 我们会得到 1436 个区间. 也就是每个用户一天共有 1436 条样本数据.

**对于 8 个特征**. 我们提取每一个区间中的 极值, 方差, 中位数, 主频.

**对于血糖属性**. 我们构造一个递推式生成函数构造每一个区间中发生高糖的先验概率. 具体的...

最终可以得到 16 个用户共 16 个 $1436 \times (p+1)$ 的特征提取结果矩阵.

#### 2.3 特征降维

最后, 对于上述得到的 16 个用户矩阵, 我们采用 PCA 再进行一次降维, 得到 16 个用户共 16 个 $1436\times (p+1) \to 1436\times (q+1) ,(q<p)$ 的降维结果矩阵.

### 三. 构建模型

### 四. 模型评估
